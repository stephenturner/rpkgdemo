<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>R Package Development with Positron ‚Ä¢ rpkgdemo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="R Package Development with Positron">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rpkgdemo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rpkgdemo.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stephenturner/rpkgdemo/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>R Package Development with Positron</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stephenturner/rpkgdemo/blob/main/vignettes/rpkgdemo.Rmd" class="external-link"><code>vignettes/rpkgdemo.Rmd</code></a></small>
      <div class="d-none name"><code>rpkgdemo.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the core elements of building an R
package, suitable for a ~2 hour workshop. The accompanying workshop will
demonstrate building an R package using Positron IDE.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="positron">Positron<a class="anchor" aria-label="anchor" href="#positron"></a>
</h3>
<p>To follow along during the live workshop, you‚Äôll need to do a few
things to get set up.</p>
<p>First, you‚Äôll need to install <a href="https://www.r-project.org/" class="external-link">R</a> and <a href="https://positron.posit.co/" class="external-link">Positron</a>.</p>
<p>To follow along the full tutorial you‚Äôll need the following packages
installed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"usethis"</span>,</span>
<span>  <span class="st">"devtools"</span>,</span>
<span>  <span class="st">"roxygen2"</span>,</span>
<span>  <span class="st">"testthat"</span>,</span>
<span>  <span class="st">"knitr"</span>,</span>
<span>  <span class="st">"rmarkdown"</span>,</span>
<span>  <span class="st">"pkgdown"</span>,</span>
<span>  <span class="st">"available"</span>,</span>
<span>  <span class="st">"dplyr"</span>,</span>
<span>  <span class="st">"janitor"</span>,</span>
<span>  <span class="st">"readxl"</span>,</span>
<span>  <span class="st">"stringr"</span>,</span>
<span>  <span class="st">"covr"</span>, </span>
<span>  <span class="st">"DT"</span>, </span>
<span>  <span class="st">"htmltools"</span>, </span>
<span>  <span class="st">"here"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="git-and-github">Git and GitHub<a class="anchor" aria-label="anchor" href="#git-and-github"></a>
</h3>
<p>You‚Äôll also want to make sure git is installed on your system, and
that you have a GitHub account set up. I also recommend setting up an
SSH key (<a href="https://github.com/settings/keys" class="external-link uri">https://github.com/settings/keys</a>) for pushing code to
GitHub.</p>
</div>
<div class="section level3">
<h3 id="air">Air<a class="anchor" aria-label="anchor" href="#air"></a>
</h3>
<p>Optional, but recommended: I like to set up <a href="https://posit-dev.github.io/air/" class="external-link">Air</a>, an R formatter for R
written in Rust. This automatically formats your code whenever you save,
fixing indentation and spacing issues. Then open up your
<code>settings.json</code> file from the Command Palette
(<code>Cmd+P</code>on Mac/Linux, <code>Ctrl+P</code> on Windows), then
run <code>Preferences: Open User Settings (JSON)</code> to modify
workspace specific settings, and add this to format on save:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="dt">"[r]"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="dt">"editor.formatOnSave"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="dt">"editor.defaultFormatter"</span><span class="fu">:</span> <span class="st">"Posit.air-vscode"</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="dt">"[quarto]"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>        <span class="dt">"editor.formatOnSave"</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        <span class="dt">"editor.defaultFormatter"</span><span class="fu">:</span> <span class="st">"quarto.quarto"</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rstudio-keybindings">RStudio keybindings<a class="anchor" aria-label="anchor" href="#rstudio-keybindings"></a>
</h3>
<p>Optional, but strongly recommended: I like to use the RStudio
keyboard shortcuts so I get things like Cmd+Shift+E to run a package
check, Cmd+Shift+D to document, Cmd+Shift+B to build. In those user
settings:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="dt">"workbench.keybindings.rstudioKeybindings"</span><span class="fu">:</span> <span class="kw">true</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="r-packages">R packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h2>
<p>R packages are collections of functions, data, and documentation that
are bundled together in a standardized structure so they can be
installed, shared, and reused.</p>
<p>Writing your own package forces you to organize your code, write
documentation, and include examples that make your work easier to
understand and reuse later. Packages make your functions portable,
installable with a single command, and versioned, which makes it much
easier to collaborate and to know exactly what code produced a given
result. Over time, maintaining and extending a package is far easier
than managing a pile of ad hoc scripts.</p>
<p>The basic development cycle for a package is a tight loop. You edit
code, try it in the console using the development version of your
package, write or update documentation, and then build and run
<code>devtools::check()</code> to catch errors, warnings, and notes
before you continue developing or share. You repeat this loop as you add
new functionality, tests, data, and examples.</p>
<p><img src="img/devloop.png" class="r-plt" alt="R package development loop"></p>
<p>In this tutorial we will make heavy use of the usethis package.
usethis provides helper functions that automate many of the repetitive
tasks in package development, such as creating the package skeleton,
adding new functions, setting up tests, configuring Git and GitHub, and
enabling pkgdown and continuous integration. By using usethis, you can
focus on writing good epidemiology and public health code while letting
the tooling handle most of the boilerplate.</p>
</div>
<div class="section level2">
<h2 id="creating-our-package">Creating our package<a class="anchor" aria-label="anchor" href="#creating-our-package"></a>
</h2>
<p>Let‚Äôs create our package! But before we do, it‚Äôs useful to check if
there are any conflicts with existing packages with the same name, and
it‚Äôll also check Wikipedia, Wiktionary, and run some simple sentiment
analysis to make sure your package name is appropriate.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">available</span><span class="fu">::</span><span class="fu">available</span><span class="op">(</span><span class="st">"rpkgdemo"</span><span class="op">)</span></span></code></pre></div>
<p>I like to use positron to start a new start a new folder, and in that
folder create the package with <code>usethis::create_package()</code>.
So create a new folder somewhere on your system called
<code>rpkgdemo</code>, open that folder in Positron, and then run the
following to create the package:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">create_package</span><span class="op">(</span><span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<p>Now there are a few one-time things we need to do here before we go
any further.</p>
<div class="section level3">
<h3 id="license">License<a class="anchor" aria-label="anchor" href="#license"></a>
</h3>
<p>First, let‚Äôs run a <code>R CMD check</code> to see if there are any
issues with our package skeleton. Run <code>devtools::check()</code> at
the console, or cmd+shift+E, or command pallette cmd+shift+P ‚ÄúR: Check R
Package‚Äù.</p>
<pre><code>W  checking DESCRIPTION meta-information ...
   Non-standard license specification:
     `use_mit_license()`, `use_gpl3_license()` or friends to pick a
     license</code></pre>
<p>Right away we see that there‚Äôs an issue with the placeholder created
by <code>usethis::create_package()</code>. We need to add a proper
license. Let‚Äôs go ahead and add an MIT license with:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_mit_license</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Edit the <code>LICENSE</code> file to add your name.</p>
<p>Run the check again.</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 6.2s

0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî</code></pre>
</div>
<div class="section level3">
<h3 id="git">Git<a class="anchor" aria-label="anchor" href="#git"></a>
</h3>
<p>Now let‚Äôs initialize a git repository for our package, and a
corresponding repo on GitHub. You can do this with the Positron Source
Control pane, or at the console:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">git</span> init</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">git</span> add .</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">"Initial commit"</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">git</span> remote add origin <span class="op">&lt;</span>your-repo-url<span class="op">&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin main</span></code></pre></div>
<p>Open up the command pallette and run
<code>Developer: Reload window</code>.</p>
<p>And take note of your GitHub repo URL. We‚Äôll need it shortly.</p>
<p>A note about <code>.gitignore</code>: You can create one yourself, or
use <code>usethis::git_vaccinate()</code>, which adds
<code>.Rproj.user</code>, <code>.Rhistory</code>, <code>.Rdata</code>,
<code>.httr-oauth</code>, <code>.DS_Store</code>, and
<code>.quarto</code> to your global (a.k.a. user-level)
<code>.gitignore</code>. This is good practice as it decreases the
chance that you will accidentally leak credentials to GitHub.
git_vaccinate() also tries to detect and fix the situation where you
have a global gitignore file, but it‚Äôs missing from your global Git
config.</p>
</div>
<div class="section level3">
<h3 id="the-description-file">The <code>DESCRIPTION</code> file<a class="anchor" aria-label="anchor" href="#the-description-file"></a>
</h3>
<p>The <code>DESCRIPTION</code> file is the metadata for your package.
It contains information about the package name, version, author,
description, license, and dependencies. Let‚Äôs go ahead and edit this
file to add some more information about our package.</p>
<p>This is what it looks like out of the box:</p>
<pre><code>Package: rpkgdemo
Title: What the Package Does (One Line, Title Case)
Version: 0.0.0.9000
Authors@R: 
    person("First", "Last", , "first.last@example.com", role = c("aut", "cre"))
Description: What the package does (one paragraph).
License: MIT + file LICENSE
Encoding: UTF-8
Roxygen: list(markdown = TRUE)
RoxygenNote: 7.3.3</code></pre>
<p>Let‚Äôs edit it to look like this (put in your own name, email, package
name, etc). Put in the URL of your GitHub repo in the URL field. Go
ahead and put in the GitHub pages URL (which we haven‚Äôt created yet but
will later). If your repo url is github.com/username/package, the GitHub
pages URL will be username.github.io/package.</p>
<pre><code>Package: rpkgdemo
Title: A demo package for building R packages
Version: 0.0.0.9000
Authors@R: 
    person("Stephen", "Turner", , "first.last@example.com", role = c("aut", "cre"),
           comment = c(ORCID = "0000-0001-9140-9028"))
Description: A package to demonstrate building an R package to accompany a
    workshop on building R packages in Positron. See the getting started
    vignette for details.
License: MIT + file LICENSE
URL: https://github.com/stephenturner/rpkgdemo, https://stephenturner.github.io/rpkgdemo/
BugReports: https://github.com/stephenturner/rpkgdemo/issues</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="functions-part-1">Functions, part 1<a class="anchor" aria-label="anchor" href="#functions-part-1"></a>
</h2>
<p>The fundamental building blocks of R packages are functions. Let‚Äôs
add some functions to our package.</p>
<div class="section level3">
<h3 id="our-first-function-no-external-dependencies">Our first function: no external dependencies<a class="anchor" aria-label="anchor" href="#our-first-function-no-external-dependencies"></a>
</h3>
<p>Let‚Äôs add a simple function that doesn‚Äôt use any external
dependencies. This function will suppress data counts below a specified
threshold by replacing them with <code>NA</code>. This might be required
in some public health setting to protect privacy when reporting small
counts.</p>
<p>All functions need to be in the <code>R/</code> directory of the
package. These are regular <code>.R</code> files. You can organize your
functions in any way you like within this directory. I like to group
related functions together in the same file. Let‚Äôs create a file called
<code>utils.R</code> to hold our utility functions.</p>
<p>You could just create a new file manually, but I like to use the
<code>usethis::use_r()</code> function, because it pairs well with
<code>usethis::use_test()</code> that we‚Äôll discuss later. For example,
to create a file named <code>utils.R</code>, you would run:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_r</span><span class="op">(</span><span class="st">"utils"</span><span class="op">)</span></span></code></pre></div>
<p>Now let‚Äôs add our function to this file.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">suppress_counts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is numeric</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be numeric."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Suppress counts below the threshold</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>  <span class="co"># Return the modified vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can try this function out in the console:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA NA  5  7  9</span></span>
<span><span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10 20 NA NA NA</span></span>
<span><span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in suppress_counts(c("a", "b", "c")): Input x must be numeric.</span></span></code></pre></div>
<p>Now we need to document our function using special ‚Äúroxygen comments‚Äù
so that we can get help on our function with
<code><a href="../reference/suppress_counts.html">?suppress_counts</a></code>. You can learn more about roxygen2 syntax
<a href="https://r-pkgs.org/man.html" class="external-link">here</a>.</p>
<p>The easiest way to do this is with the Positron Code Action to
generate a roxygen skeleton. Place your cursor on the function name and
invoke the Code Action by clicking the üí°.</p>
<p><img src="img/gen-roxy-template.png" class="r-plt" alt="Positron Code Action to insert a roxygen skeleton for a function"></p>
<p>This will result in something that looks like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Title</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x</span></span>
<span><span class="co">#' @param threshold</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="va">suppress_counts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is numeric</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be numeric."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Suppress counts below the threshold</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>  <span class="co"># Return the modified vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Before we can use the function, we need to generate the documentation
files. We can do this with the <code>devtools::document()</code>
function, which processes the roxygen comments and creates the necessary
files in the <code>man/</code> directory. You can also use the keyboard
shortcut cmd+shift+D to run this command.</p>
<p>You‚Äôll see some errors:</p>
<pre><code>‚úñ utils.R:3: @param requires two parts: an argument name and a description.
‚úñ utils.R:6: @returns requires a value.
‚úñ utils.R:9: @examples requires a value.</code></pre>
<p>Let‚Äôs go ahead and fill out our full documentation.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Suppress Low Counts for Privacy</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Replaces numeric counts below a threshold with a suppression character ("NA").</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A numeric vector of counts.</span></span>
<span><span class="co">#' @param threshold Numeric. Values strictly less than this are suppressed. Default 5.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A vector.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' suppress_counts(c(1, 3, 5, 7, 9))</span></span>
<span><span class="co">#' suppress_counts(c(10, 20, 3, 4, 5), threshold = 10)</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">suppress_counts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is numeric</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be numeric."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Suppress counts below the threshold</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>  <span class="co"># Return the modified vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Document and build the package again. Now try
<code><a href="../reference/suppress_counts.html">?suppress_counts</a></code> to see the help file.</p>
<p><img src="img/suppress-counts-help.png" class="r-plt" alt="Help file for the suppress_counts function"></p>
<p>Go ahead and run a check (cmd+shift+E) to make sure everything is
working so far.</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 8.7s

0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî</code></pre>
</div>
<div class="section level3">
<h3 id="adding-additional-arguments">Adding additional arguments<a class="anchor" aria-label="anchor" href="#adding-additional-arguments"></a>
</h3>
<p>Now let‚Äôs add an additional argument to our function to allow users
to specify a custom suppression value. R is smart enough to
automatically change the type to character if we provide a character
suppression symbol.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Suppress Low Counts for Privacy</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Replaces numeric counts below a threshold with a suppression character (`NA`).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A numeric vector of counts.</span></span>
<span><span class="co">#' @param threshold Numeric. Values strictly less than this are suppressed. Default 5.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A vector.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' suppress_counts(c(1, 3, 5, 7, 9))</span></span>
<span><span class="co">#' suppress_counts(c(10, 20, 3, 4, 5), threshold = 10)</span></span>
<span><span class="co">#' suppress_counts(1:10, threshold = 5, symbol = "*")</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">suppress_counts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">symbol</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is numeric</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be numeric."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Suppress counts below the threshold</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">symbol</span></span>
<span></span>
<span>  <span class="co"># Return the modified vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you rebuild the package the function will work:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">5</span>, symbol <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span></span></code></pre></div>
<p>But now run a check (cmd+shift+E) and you‚Äôll see a warning:</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 9.2s

‚ùØ checking Rd \usage sections ... WARNING
  Undocumented arguments in Rd file 'suppress_counts.Rd'
    ‚Äòsymbol‚Äô
  
  Functions with \usage entries need to have the appropriate \alias
  entries, and all their arguments documented.
  The \usage entries must correspond to syntactically valid R code.
  See chapter ‚ÄòWriting R documentation files‚Äô in the ‚ÄòWriting R
  Extensions‚Äô manual.

0 errors ‚úî | 1 warning ‚úñ | 0 notes ‚úî
Error: R CMD check found WARNINGs
Execution halted</code></pre>
<p>So go back and add documentation for the new <code>symbol</code>
argument.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Suppress Low Counts for Privacy</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Replaces numeric counts below a threshold with a suppression character (`NA`).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A numeric vector of counts.</span></span>
<span><span class="co">#' @param threshold Numeric. Values strictly less than this are suppressed. Default 5.</span></span>
<span><span class="co">#' @param symbol Character or `NA`. The symbol to use for suppression. Default is `NA`.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A vector.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' suppress_counts(c(1, 3, 5, 7, 9))</span></span>
<span><span class="co">#' suppress_counts(c(10, 20, 3, 4, 5), threshold = 10)</span></span>
<span><span class="co">#' suppress_counts(1:10, threshold = 5, symbol = "*")</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">suppress_counts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">threshold</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">symbol</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is numeric</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be numeric."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Suppress counts below the threshold</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">symbol</span></span>
<span></span>
<span>  <span class="co"># Return the modified vector</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Everything should check out!</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 9.1s

0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî</code></pre>
<p><strong>Congratulations!</strong> You‚Äôve created your first function,
documented it, and built your package!</p>
<p>Before we go on, take a look at what additional files were created
when you documented your package. You‚Äôll never actually edit these by
hand.</p>
<p>The <code>NAMESPACE</code> file:</p>
<pre><code><span><span class="co"># Generated by roxygen2: do not edit by hand</span></span>
<span></span>
<span><span class="fu">export</span><span class="op">(</span><span class="va">suppress_counts</span><span class="op">)</span></span></code></pre>
<p>The <code>man/suppress_counts.Rd</code> file:</p>
<pre><code>% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils.R
\name{suppress_counts}
\alias{suppress_counts}
\title{Suppress Low Counts for Privacy}
\usage{
suppress_counts(x, threshold = 5, symbol = NA)
}
\arguments{
\item{x}{A numeric vector of counts.}

\item{threshold}{Numeric. Values strictly less than this are suppressed. Default 5.}

\item{symbol}{Character or \code{NA}. The symbol to use for suppression. Default is \code{NA}.}
}
\value{
A vector.
}
\description{
Replaces numeric counts below a threshold with a suppression character (\code{NA}).
}
\examples{
suppress_counts(c(1, 3, 5, 7, 9))
suppress_counts(c(10, 20, 3, 4, 5), threshold = 10)
suppress_counts(1:10, threshold = 5, symbol = "*")

}</code></pre>
<p>Prior to Roxygen2, you would have had to create these files by
hand!</p>
</div>
<div class="section level3">
<h3 id="our-second-function-with-external-dependencies">Our second function: with external dependencies<a class="anchor" aria-label="anchor" href="#our-second-function-with-external-dependencies"></a>
</h3>
<p>Let‚Äôs add another function to map messy categorical inputs to
standard codes (e.g., standardizing sex or gender entries). Here we‚Äôre
going to mape various inputs like ‚ÄúM‚Äù, ‚Äúfemale‚Äù, etc. to standard FHIR
(Fast Health Interoperability Resources) HL7 specs for healthcare
interoperability. We‚Äôll be using <a href="https://hl7-definition.caristix.com/v2/HL7v2.3/Tables/0001" class="external-link">HL7
v2.3</a> which allows for F (Female), M (Male), O (Other), U
(Unknown).</p>
<p>Let‚Äôs go ahead and stick this into <code>R/utils.R</code> as
well.</p>
<p>Now, to use a function from another package we‚Äôll need to call the
function using the <code>::</code> operator to avoid adding a dependency
on the entire package. In this case, we‚Äôll use the
<code><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">dplyr::case_when()</a></code> function from the <code>dplyr</code>
package to map various inputs to standardized codes.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Standardize Sex Variables</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Maps various inputs (M, Male, f, Female) to standard HL7/ISO codes (M, F, O, U).</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A character vector of sex/gender inputs.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return A character vector containing "M", "F", "O", or "U".</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' standardize_sex(c("Male", "f", "Trans female", "nonbinary", "unknown", NA))</span></span>
<span><span class="va">standardize_sex</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check if input is character</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input x must be a character vector."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># trim whitespace and make lowercase</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Map various inputs to standard codes</span></span>
<span>  <span class="va">standardized</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"m"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"M"</span>,</span>
<span>    <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"f"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"F"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"trans|non|binary"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">~</span> <span class="st">"O"</span>,</span>
<span>    .default <span class="op">=</span> <span class="st">"U"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">standardized</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Document and build the package again and try the function out.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"f"</span>, <span class="st">"Trans female"</span>, <span class="st">"nonbinary"</span>, <span class="st">"unknown"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "M" "F" "O" "O" "U" "U"</span></span>
<span><span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in standardize_sex(c(1, 2, 1, 2)): Input x must be a character vector.</span></span></code></pre></div>
<p>But now run a check (cmd+shift+E) and you‚Äôll see an error:</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 9.2s

‚ùØ checking dependencies in R code ... WARNING
  '::' or ':::' import not declared from: ‚Äòdplyr‚Äô

0 errors ‚úî | 1 warning ‚úñ | 0 notes ‚úî
Error: R CMD check found WARNINGs
Execution halted</code></pre>
<p>This is because you‚Äôre using a function from the <code>dplyr</code>
package but haven‚Äôt declared that your package depends on it. To fix
this, you need to add <code>dplyr</code> to the <code>Imports</code>
field in your <code>DESCRIPTION</code> file. The easiest way to do this
is with the <code>usethis::use_package()</code> function:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre></div>
<p>You‚Äôll see at the console:</p>
<pre><code>‚úî Adding dplyr to Imports field in DESCRIPTION.
‚òê Refer to functions with `dplyr::fun()`.</code></pre>
<p>And if you open up your <code>DESCRIPTION</code> file now, you‚Äôll see
the imported dependency:</p>
<pre><code><span><span class="va">Imports</span><span class="op">:</span> </span>
<span>    <span class="va">dplyr</span></span></code></pre>
<p>Now run a check (cmd+shift+E) again and everything should be
good!</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 15.9s

0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî</code></pre>
<p>Take note that the package check took a few seconds longer, because R
had to load the <code>dplyr</code> package to check your code. This
brings up another point we won‚Äôt cover today about packages with heavy
dependencies. See the <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC9438947/" class="external-link">pkgndep
paper</a> and <a href="https://github.com/jokergoo/pkgndep" class="external-link">pkgndep
package</a> for details on analyzing dependency ‚Äúheaviness.‚Äù</p>
</div>
</div>
<div class="section level2">
<h2 id="package-data">Package data<a class="anchor" aria-label="anchor" href="#package-data"></a>
</h2>
<p>We‚Äôll come back and add more functions to the package soon, but let‚Äôs
take a quick detour to add some package data. There are a few different
ways to include data in your package.</p>
<ol style="list-style-type: decimal">
<li>Exported data. This is like the <code>iris</code> dataset that comes
with R, or the <code>starwars</code> data that‚Äôs available after you
load dplyr. This data is stored in the <code>data/</code> directory of
your package and is made available to users when they load your
package.</li>
<li>Raw data. This is data that is stored in the
<code>inst/extdata/</code> (installed / external data) directory of your
package and can be read in by your functions as needed. This is useful
for demonstrating functions for reading in data files.</li>
<li>Internal data. This is data that is used internally by your package
functions but is not exported to the user.</li>
</ol>
<p>We‚Äôll cover the first two in this tutorial.</p>
<div class="section level3">
<h3 id="exported-data">Exported data<a class="anchor" aria-label="anchor" href="#exported-data"></a>
</h3>
<p>As noted above, exported data is stored in the <code>data/</code>
directory of your package. The data should be stored in
<code>.rda</code> format, and must be documented. But the data in
<code>data/</code> is usually a clean version of raw data you‚Äôve
gathered from elsewhere or created from code. And for the sake of
reproducibility, it‚Äôs best practice to include the code used to create
the data in the <code>data-raw/</code> directory of your package.</p>
<p>The best way to do this is to call
<code>usethis::use_data_raw()</code> which will create the
<code>data-raw/</code> directory and a template script for creating your
data, along with adding the <code>data-raw</code> directory to your
<code>.Rbuildignore</code> file so that it doesn‚Äôt get included when you
build your package.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data_raw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>That should create a file at <code>data-raw/DATASET.R</code>. You can
name this file whatever you want. We‚Äôre going to create two datasets:
one that we download from the web and process/clean up a bit, and
another that we create completely from code.</p>
<div class="section level4">
<h4 id="external-data-from-the-web">External data from the web<a class="anchor" aria-label="anchor" href="#external-data-from-the-web"></a>
</h4>
<p>Let‚Äôs create a dataset that links ZIP code to city and state. You can
get this data from the postal service at <a href="https://postalpro.usps.com/ZIP_Locale_Detail" class="external-link uri">https://postalpro.usps.com/ZIP_Locale_Detail</a>.</p>
<p>In your <code>data-raw/DATASET.R</code>, write and run the following
code to download the excel file, read in tab #2, and do some cleanup
before writing it out.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># It's okay to load a package in this file - it's not part of the package itself</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the USPS ZIP code data</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://postalpro.usps.com/mnt/glusterfs/2025-12/ZIP_Locale_Detail.xls"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">url</span>, destfile <span class="op">=</span> <span class="va">tf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read in the data</span></span>
<span><span class="va">zipcodes_raw</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu">read_excel</span><span class="op">(</span><span class="va">tf</span>, sheet <span class="op">=</span> <span class="st">"ZIP_DETAIL"</span><span class="op">)</span></span>
<span><span class="va">zipcodes_raw</span></span>
<span></span>
<span><span class="co"># select relevant columns and clean up</span></span>
<span><span class="va">zipcodes</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zipcodes_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    zip <span class="op">=</span> <span class="va">`DELIVERY ZIPCODE`</span>,</span>
<span>    city <span class="op">=</span> <span class="va">`PHYSICAL CITY`</span>,</span>
<span>    state <span class="op">=</span> <span class="va">`PHYSICAL STATE`</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">zip</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>city <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu">str_to_title</span><span class="op">(</span><span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">zip</span>, <span class="va">city</span><span class="op">)</span></span>
<span><span class="va">zipcodes</span></span>
<span></span>
<span><span class="co"># Save the dataset in the package</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data</span><span class="op">(</span><span class="va">zipcodes</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>You‚Äôll see a few notes:</p>
<pre><code>&gt; usethis::use_data(zipcodes, overwrite = TRUE)
‚úî Adding R to Depends field in DESCRIPTION.
‚úî Creating data/.
‚úî Setting LazyData to "true" in DESCRIPTION.
‚úî Saving "zipcodes" to "data/zipcodes.rda".
‚òê Document your data (see &lt;https://r-pkgs.org/data.html&gt;).</code></pre>
<p>Note that last line ‚Äì you need to document the data itself! If you
don‚Äôt believe me, run a check.</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ

Duration: 12.1s

‚ùØ checking for missing documentation entries ... WARNING
  Undocumented code objects:
    ‚Äòzipcodes‚Äô
  Undocumented data sets:
    ‚Äòzipcodes‚Äô
  All user-level objects in a package should have documentation entries.
  See chapter ‚ÄòWriting R documentation files‚Äô in the ‚ÄòWriting R
  Extensions‚Äô manual.

0 errors ‚úî | 1 warning ‚úñ | 0 notes ‚úî
Error: R CMD check found WARNINGs
Execution halted</code></pre>
<p>Let‚Äôs go ahead and document the data. We generally document all our
package data in a <code>R/data.R</code> file.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_r</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>The data documentation looks a lot like function documentation. The
only confusing things are (1) we never <code>@export</code> data, even
though it‚Äôs technically exported, and (2) we simply enter
<code>"datasetname"</code> after the roxygen block to actually export
the data. It should look like this:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' ZIP code data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' ZIP code data from the US Postal Service.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @format A data frame with three columns</span></span>
<span><span class="co">#' 1. `zip`: The ZIP code.</span></span>
<span><span class="co">#' 2. `city`: The U.S. city for that zip code.</span></span>
<span><span class="co">#' 3. `state`: The U.S. state for that zip code.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @source &lt;https://postalpro.usps.com/ZIP_Locale_Detail&gt;</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' zipcodes</span></span>
<span><span class="co">#'</span></span>
<span><span class="st">"zipcodes"</span></span></code></pre></div>
<p>Document (cmd+shift+d), rebuild (cmd+shift+b), check (cmd+shift+e)
again and everything should be good! Try running <code><a href="../reference/zipcodes.html">?zipcodes</a></code>
to see the help file for the dataset.</p>
</div>
<div class="section level4">
<h4 id="creating-data-from-code">Creating data from code<a class="anchor" aria-label="anchor" href="#creating-data-from-code"></a>
</h4>
<p>In that same <code>data-raw/DATASET.R</code> file, let‚Äôs create a
synthetic dataset that we can use to demonstrate our functions.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create some sex variables to sample from</span></span>
<span><span class="va">sexes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"male"</span>,</span>
<span>  <span class="st">"female"</span>,</span>
<span>  <span class="st">"Male"</span>,</span>
<span>  <span class="st">"Female"</span>,</span>
<span>  <span class="st">"M"</span>,</span>
<span>  <span class="st">"F"</span>,</span>
<span>  <span class="st">"m"</span>,</span>
<span>  <span class="st">"f"</span>,</span>
<span>  <span class="st">"transgender"</span>,</span>
<span>  <span class="st">"trans male"</span>,</span>
<span>  <span class="st">"Trans Female"</span>,</span>
<span>  <span class="st">"non-binary"</span>,</span>
<span>  <span class="st">"Unknown"</span>,</span>
<span>  <span class="st">"unk"</span>,</span>
<span>  <span class="st">"???"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sexes</span></span>
<span></span>
<span><span class="co"># Get only virginia zip codes</span></span>
<span><span class="va">vazips</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">zipcodes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"VA"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">zip</span><span class="op">)</span></span>
<span><span class="va">vazips</span></span>
<span></span>
<span><span class="co"># Create a 1000 row dataset. Make sure to set a random seed!</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20251205</span><span class="op">)</span></span>
<span><span class="va">rped</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">sexes</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">20L</span><span class="op">:</span><span class="fl">60L</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    zip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">vazips</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    lab1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, lambda <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    lab2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, lambda <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">zip</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Add some noise</span></span>
<span><span class="va">rped</span><span class="op">$</span><span class="va">zip</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"12345"</span></span>
<span><span class="va">rped</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span></span>
<span><span class="va">rped</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">120</span></span>
<span><span class="va">rped</span></span>
<span></span>
<span><span class="co"># Save the dataset in the package</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data</span><span class="op">(</span><span class="va">rped</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Go ahead and open up <code>R/data.R</code> again and add
documentation for this dataset as well. Don‚Äôt close this file, we‚Äôll
come back to it momentarily.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' RPED: R Package Example Data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Simulated data for demonstrating the functionality of the rpkgdemo package.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @format A data frame with 6 columns:</span></span>
<span><span class="co">#' 1. `id`: A unique identifier for each individual.</span></span>
<span><span class="co">#' 2. `sex`: The sex of the individual.</span></span>
<span><span class="co">#' 3. `age`: The age of the individual.</span></span>
<span><span class="co">#' 4. `zip`: The ZIP code of the individual's residence.</span></span>
<span><span class="co">#' 5. `lab1`: A simulated lab value from a Poisson distribution with lambda=2.</span></span>
<span><span class="co">#' 6. `lab2`: A simulated lab value from a Poisson distribution with lambda=10.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' rped</span></span>
<span><span class="co">#'</span></span>
<span><span class="st">"rped"</span></span></code></pre></div>
<p>And run a document, build, check once more.</p>
</div>
</div>
<div class="section level3">
<h3 id="raw-data">Raw data<a class="anchor" aria-label="anchor" href="#raw-data"></a>
</h3>
<p>In a few minutes we‚Äôre going to write a function to read in data like
this from a CSV file that sets a few options not in the
<code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv()</a></code> defaults. Above we created some example
data we can work with by just running <code>rped</code>, but to write
examples (and later tests) with a function to read in files, we actually
need data stored in a file that we can access from our function.</p>
<p>Go back into your <code>data-raw/DATASET.R</code> file and add this
to the very end of the data generation script you have.</p>
<p>If you‚Äôve never used <code>here::here()</code> before, it‚Äôs a great
way to create file paths relative to the root of your project,
regardless of your working directory. It looks for a <code>.git</code>
directory or a <code>DESCRIPTION</code> file. Try it.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write as installed data</span></span>
<span><span class="va">extdatadir</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"inst/extdata"</span><span class="op">)</span></span>
<span><span class="va">extdatadir</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">extdatadir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">rped</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"inst/extdata/rped.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Rebuild the package, and try running this code below. This will
retrieve the absolute path to this installed raw data <em>on your
system</em>. It‚Äôll look different than what you see below for me.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/rped.csv"</span>, package <span class="op">=</span> <span class="st">"rpkgdemo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/rpkgdemo/extdata/rped.csv"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="functions-part-2">Functions, part 2<a class="anchor" aria-label="anchor" href="#functions-part-2"></a>
</h2>
<p>Now that we have some built-in package data (exported and raw files),
let‚Äôs add a few more functions.</p>
<div class="section level3">
<h3 id="read-in-raw-data">Read in raw data<a class="anchor" aria-label="anchor" href="#read-in-raw-data"></a>
</h3>
<p>First, let‚Äôs write a function to read data like we created above from
a file. Sure, you could just use <code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv()</a></code>. But
imagine you‚Äôve got some data from zip codes 02108 (Boston, MA) or 00901
(San Juan, PR)? These zip codes have leading zeros that get stripped
when read in as numeric. So let‚Äôs create a function that always reads in
zip codes as character, sex as character, and age as integer. If you try
to read in some other data with this function, it‚Äôll throw warnings
and/or errors.</p>
<p>Back in <code>R/utils.R</code>, add this function, fully documented,
with examples. Note you have to prefix <em>all</em> the readr functions
with <code>readr::</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read laboratory data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Read laboratory data from a file</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param file A file path</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns A data frame</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' fp &lt;- system.file("extdata/rped.csv", package = "rpkgdemo", mustWork = TRUE)</span></span>
<span><span class="co">#' read_labdata(fp)</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">read_labdata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>    <span class="va">file</span>,</span>
<span>    col_types <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span></span>
<span>      sex <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      age <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      zip <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html" class="external-link">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      .default <span class="op">=</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/parse_guess.html" class="external-link">col_guess</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note here that the example uses <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code> to get the
path to the installed raw data file we created earlier. Document, build,
check.</p>
<p>Oops ‚Äì we have a warning. We forgot to import the <code>readr</code>
package!</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo <span class="dv">0</span>.<span class="dv">0</span>.<span class="fl">0.9000</span> ‚îÄ‚îÄ</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>Duration<span class="sc">:</span> <span class="fl">13.7</span>s</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>‚ùØ checking dependencies <span class="cf">in</span> R code ... WARNING</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>  <span class="st">'::'</span> or <span class="st">':::'</span> import not declared from<span class="sc">:</span> ‚Äòreadr‚Äô</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a><span class="dv">0</span> errors ‚úî <span class="sc">|</span> <span class="dv">1</span> warning ‚úñ <span class="sc">|</span> <span class="dv">0</span> notes ‚úî</span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>Error<span class="sc">:</span> R CMD check found WARNINGs</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>Execution halted</span></code></pre></div>
<p>Add it to the <code>Imports</code> in <code>DESCRIPTION</code> with
usethis:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_package</span><span class="op">(</span><span class="st">"readr"</span><span class="op">)</span></span></code></pre></div>
<p>Check once again and it should be clean.</p>
</div>
<div class="section level3">
<h3 id="using-dplyr-data-masking-in-packages">Using dplyr data masking in packages<a class="anchor" aria-label="anchor" href="#using-dplyr-data-masking-in-packages"></a>
</h3>
<p>Let‚Äôs add another function that uses piped dplyr code with data
masking. Here‚Äôs the full function with roxygen documentation. This
standardizes the <code>sex</code> variable using our earlier function,
joins with the <code>zipcodes</code> data, and centers and scales lab
values.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Prepare lab data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Prepare lab data for analysis. Standardizes the `sex` variable, joins with `zipcodes` data, centers and scales lab values.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A data frame containing lab data with at least `sex`, `zip`, and lab value columns starting with "lab".</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns A data frame with standardized `sex`, joined `zipcodes`, and scaled lab values.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' prep_lab_data(rped)</span></span>
<span><span class="co">#' </span></span>
<span><span class="va">prep_lab_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">zipcodes</span>, by <span class="op">=</span> <span class="st">"zip"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"lab"</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Write this function, document, and build the package, and the
function will work. But what happens when we check the package? We get
some weird <code>NOTE</code>s.</p>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 12.7s

‚ùØ checking R code for possible problems ... NOTE
  prep_lab_data: no visible binding for global variable ‚Äòsex‚Äô
  prep_lab_data: no visible binding for global variable ‚Äòzipcodes‚Äô
  Undefined global functions or variables:
    sex zipcodes

0 errors ‚úî | 0 warnings ‚úî | 1 note ‚úñ</code></pre>
<p>This is because of how dplyr does data masking with the pipe operator
(<code>|&gt;</code>). R CMD check can‚Äôt see where <code>sex</code> or
<code>zipcodes</code> are coming from, so it throws a NOTE. You can see
lots of solutions to this problem by Googling or asking Chat how to fix
the ‚Äúno visible binding for global variable‚Äù problem. Some of them
involve declaring global variables. But the best practice is described
in the <a href="https://dplyr.tidyverse.org/articles/in-packages.html" class="external-link">Using dplyr
in packages vignette</a>. The best way to do this is with the <a href="https://rlang.r-lib.org/reference/dot-data.html" class="external-link">‚Äú<code>.data</code>
pronoun‚Äù from rlang</a>. We‚Äôll have to put <code>.data$</code> in front
of <code>sex</code>. We‚Äôll also need to explicitly reference the
<code>zipcodes</code> data from the package we‚Äôre building with
<code><a href="../reference/zipcodes.html">rpkgdemo::zipcodes</a></code>.</p>
<p>You can do this now, but you‚Äôll get another note saying that you have
an undefined global function/variable called <code>.data</code>. The way
to fix this is to import <code>.data</code> from <code>rlang</code> with
usethis. You only have to do this once. You‚Äôll get a note about
package-level documentation. Go ahead and accept. Document, rebuild,
check.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_import_from</span><span class="op">(</span><span class="st">"rlang"</span>, <span class="st">".data"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, let‚Äôs add some sanity checking to our function to throw some
warnings if we have ZIP codes that aren‚Äôt real, ages that are out of
range, or minors in the dataset. Notice that I‚Äôm adding an option for
whether these warnings are issued or not. We‚Äôll examine this when we get
to testing below. Here‚Äôs the final function:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Prepare lab data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Prepare lab data for analysis. Standardizes the `sex` variable, joins with `zipcodes` data, centers and scales lab values.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A data frame containing lab data with at least `sex`, `zip`, and lab value columns starting with "lab".</span></span>
<span><span class="co">#' @param warnings Logical. Whether to issue warnings for potential data issues (bad zip codes, minors, unrealistic ages). Default is `TRUE`.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns A data frame with standardized `sex`, joined `zipcodes`, and scaled lab values.</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' prep_lab_data(rped)</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">prep_lab_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">warnings</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Check for potential issues</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">warnings</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Check for bad zip codes</span></span>
<span>    <span class="va">badzips</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">zip</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/zipcodes.html">zipcodes</a></span><span class="op">$</span><span class="va">zip</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">badzips</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Found "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">badzips</span><span class="op">)</span>, <span class="st">" bad zip code(s)."</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Check for minors</span></span>
<span>    <span class="va">minors</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">18</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">minors</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Found "</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">minors</span><span class="op">)</span>, <span class="st">" minor(s) in dataset."</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Check for unrealistic numbers</span></span>
<span>    <span class="va">unrealistic</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">x</span><span class="op">$</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">120</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">unrealistic</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"Found "</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">unrealistic</span><span class="op">)</span>,</span>
<span>        <span class="st">" unrealistic age(s) in dataset."</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Prepare the data</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/zipcodes.html">zipcodes</a></span>, by <span class="op">=</span> <span class="st">"zip"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"lab"</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="tests">Tests<a class="anchor" aria-label="anchor" href="#tests"></a>
</h2>
<p>Testing is an essential part of building a robust R package. It helps
ensure that your functions work as expected and can catch bugs early in
the development process. We‚Äôll use the <code>testthat</code> package,
which is the most popular testing framework in the R community.</p>
<p>You can read more about testing in <a href="https://r-pkgs.org/testing-basics.html" class="external-link">Testing chapter of the R
Packages book</a> and in the <a href="https://testthat.r-lib.org/" class="external-link">testthat documentation</a>.</p>
<div class="section level3">
<h3 id="setting-up-testthat">Setting up testthat<a class="anchor" aria-label="anchor" href="#setting-up-testthat"></a>
</h3>
<p>As always, we‚Äôll use <code>usethis</code> to set up our testing
infrastructure. Just as we used <code>usethis::use_r("utils")</code> to
create <code>R/utils.R</code>, we‚Äôll use a similar pattern here to
create the initial testthat infrastructure, and a test file for our
<code>utils.R</code> functions.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_test</span><span class="op">(</span><span class="st">"utils"</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚úî Adding testthat to Suggests field in DESCRIPTION.
‚úî Adding "3" to Config/testthat/edition.
‚úî Creating tests/testthat/.
‚úî Writing tests/testthat.R.
‚úî Writing tests/testthat/test-utils.R.
‚òê Modify tests/testthat/test-utils.R.</code></pre>
<p>Go ahead and play around with the boilerplate multiplication test
already set up. Then you can run the package tests with
<code>devtools::test()</code> or with the keyboard shortcut
cmd+shift+T.</p>
</div>
<div class="section level3">
<h3 id="our-first-real-tests">Our first real tests<a class="anchor" aria-label="anchor" href="#our-first-real-tests"></a>
</h3>
<p>At this point you want to open up utils.R and test-utils.R side by
side and start writing tests that will cover every component of the
code.</p>
<p>Let‚Äôs go through in detail what I‚Äôm doing here. Notice that I‚Äôm first
creating a result object <code>res</code> that holds the result of
running the function. I‚Äôm wrapping that whole assignment in an
<code>expect_silent()</code>, which would fail if the function throws a
warning. Then I‚Äôm using <code>expect_*()</code> functions to check that
the result is what I expect. Finally, I‚Äôm also testing that the function
throws an error when given incorrect input, which it should. If the
function doesn‚Äôt throw an error when it should, the test will fail.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"suppress_counts"</span>, <span class="op">{</span></span>
<span>  <span class="co"># Correct usage</span></span>
<span>  <span class="fu">expect_silent</span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_silent</span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_silent</span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, threshold <span class="op">=</span> <span class="fl">5</span>, symbol <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">==</span> <span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Incorrect usage</span></span>
<span>  <span class="fu">expect_error</span><span class="op">(</span><span class="fu"><a href="../reference/suppress_counts.html">suppress_counts</a></span><span class="op">(</span><span class="st">"not numeric"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="coverage-with-covr">Coverage with covr<a class="anchor" aria-label="anchor" href="#coverage-with-covr"></a>
</h3>
<p>Testing all possible use cases of your functions can be tedious. The
<code>covr</code> package can help you identify which lines of code are
covered by your tests and which are not.</p>
<p>You can get a high-level summary of test coverage with:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>&gt; covr::package_coverage()
rpkgdemo Coverage: 9.30%
R/utils.R: 9.30%</code></pre>
<p>This is telling us we have terrible coverage. Let‚Äôs keep adding tests
to that file:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"standardize_sex"</span>, <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"male"</span>, <span class="st">"M"</span>, <span class="st">"m"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"female"</span>, <span class="st">"F"</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"F"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Trans female"</span>,</span>
<span>    <span class="st">"transgender"</span>,</span>
<span>    <span class="st">"nonbinary"</span>,</span>
<span>    <span class="st">"non-binary"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"O"</span>, <span class="st">"O"</span>, <span class="st">"O"</span>, <span class="st">"O"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unknown"</span>, <span class="st">"xyz"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"U"</span>, <span class="st">"U"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_sex.html">standardize_sex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"  Male  "</span>, <span class="st">"  female  "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This time, instead of running <code>covr::package_coverage()</code>,
let‚Äôs use the <code>covr::report()</code> function which will generate
an HTML report that you can view in your web browser. This report will
show you which lines of code are covered by your tests and which are
not.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">covr</span><span class="fu">::</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/covr-1.png" class="r-plt" alt="Coverage report overview"></p>
<p>If you click on the particular source code file, you can see where
you have coverage and where you don‚Äôt. It‚Äôs clear from our coverage
report that we didn‚Äôt test the error handling in the
<code><a href="../reference/standardize_sex.html">standardize_sex()</a></code> function, and we didn‚Äôt test the
remaining functions at all.</p>
<p><img src="img/covr-2.png" class="r-plt" alt="Coverage report detail"></p>
<p>We can continue writing tests until we have 100% coverage, but in
real life that‚Äôs not always feasible. Aim for high coverage, but focus
on testing the most important parts of your code. Pro-tip: nearly any
Frontier AI model can automate all the tedious parts of writing tests
for you. I‚Äôve had good success with <a href="https://blog.stephenturner.us/p/positron-assistant-copilot-chat-agent" class="external-link">Positron
Assistant</a>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>rpkgdemo Coverage: 100.00%
R/utils.R: 100.00%</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚Ñπ Testing rpkgdemo
‚úî | F W  S  OK | Context
‚úî |         25 | utils               

‚ïê‚ïê Results ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê==========
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 25 ]</code></pre>
<p>Make sure to document, build, and check one last time to ensure
everything is working. Notice now when you run a
<code>devtools::check()</code> it automatically runs all the tests in
the package!</p>
</div>
</div>
<div class="section level2">
<h2 id="recap-data-functions-tests">Recap: data + functions + tests<a class="anchor" aria-label="anchor" href="#recap-data-functions-tests"></a>
</h2>
<p>Let‚Äôs put together everything we‚Äôve done so far to (1) create a
function that (2) relies on internal package data that‚Äôs (3) built from
<code>data-raw</code> using a script.</p>
<p>Imagine we want to to create a function to harmonize different
representations of race or ethnicity up to a smaller set of broad
categories. E.g., ‚ÄúBlack/African American,‚Äù ‚ÄúBlack,‚Äù and ‚ÄúBlack or
African American‚Äù all rolled up to ‚ÄúBlack/African American‚Äù; or ‚ÄúNative
Hawaiian/Other Pacific Islander,‚Äù ‚ÄúNH/PI,‚Äù or ‚ÄúNative Hawaiian/Pacific
Islander‚Äù up to ‚ÄúNative Hawaiian/Other Pacific Islander.‚Äù We could
construct some complex function for this:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    race_harmonized <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">.data</span><span class="op">$</span><span class="va">race</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="st">"def"</span>, <span class="st">"ghi"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"harmonized category 1"</span>,</span>
<span>      <span class="va">.data</span><span class="op">$</span><span class="va">race</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"jkl"</span>, <span class="st">"mno"</span>, <span class="st">"pqr"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"harmonized category 2"</span>,</span>
<span>      <span class="va">.data</span><span class="op">$</span><span class="va">race</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stu"</span>, <span class="st">"vwx"</span>, <span class="st">"yz1"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"harmonized category 3"</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>But now we‚Äôre tangling the logic of the function (<code>mutate</code>
and <code>case_when</code> for recoding) with the actual data (the
various representations of race entries and their corresponding rolled
up high level class). And, perhaps we want to update this mapping over
time as we encounter new representations. A better way to do this is to
create a CSV file in <code>data-raw/</code> that contains the mapping,
read that into the package as internal data, then have the function read
from that internal data to do the harmonization. Let‚Äôs do that.</p>
<p>First, create a CSV file that looks something like this. We have
<code>orace</code> (‚Äúoriginal race‚Äù) and <code>hrace</code> (‚Äúharmonized
race‚Äù).</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data-raw/racemap.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, save this CSV file in <code>data-raw/</code>.</p>
<p>In <code>data-raw/DATASET.R</code>, add code to read in this CSV file
and save it as internal data in the package.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racemap</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data-raw/racemap.csv"</span><span class="op">)</span>, col_types <span class="op">=</span> <span class="st">"cc"</span><span class="op">)</span></span>
<span><span class="va">racemap</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">deframe</a></span><span class="op">(</span><span class="va">racemap</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data</span><span class="op">(</span><span class="va">racemap</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>And document it in <code>R/data.R</code>:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Race mapping</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A named character vector mapping various race categories to a harmonized variable</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @format A named character vector.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' racemap</span></span>
<span><span class="co">#' racemap["AI/AN"]</span></span>
<span><span class="co">#' racemap["Black"]</span></span>
<span><span class="co">#' racemap["Doesn't exist in the mapping"]</span></span>
<span><span class="co">#' table(racemap)</span></span>
<span><span class="co">#'</span></span>
<span><span class="st">"racemap"</span></span></code></pre></div>
<p>Take a look at that object. It‚Äôs a named character vector.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">racemap</span></span>
<span><span class="co">#&gt;            American Indian/Alaska Native </span></span>
<span><span class="co">#&gt;          "American Indian/Alaska Native" </span></span>
<span><span class="co">#&gt;                                    AI/AN </span></span>
<span><span class="co">#&gt;          "American Indian/Alaska Native" </span></span>
<span><span class="co">#&gt;           Native American/Alaskan Native </span></span>
<span><span class="co">#&gt;          "American Indian/Alaska Native" </span></span>
<span><span class="co">#&gt;                                       R1 </span></span>
<span><span class="co">#&gt;          "American Indian/Alaska Native" </span></span>
<span><span class="co">#&gt;                                    Asian </span></span>
<span><span class="co">#&gt;                                  "Asian" </span></span>
<span><span class="co">#&gt;                                       R2 </span></span>
<span><span class="co">#&gt;                                  "Asian" </span></span>
<span><span class="co">#&gt;                   Black/African American </span></span>
<span><span class="co">#&gt;                 "Black/African American" </span></span>
<span><span class="co">#&gt;                                    Black </span></span>
<span><span class="co">#&gt;                 "Black/African American" </span></span>
<span><span class="co">#&gt;                Black or African American </span></span>
<span><span class="co">#&gt;                 "Black/African American" </span></span>
<span><span class="co">#&gt;                                       R3 </span></span>
<span><span class="co">#&gt;                 "Black/African American" </span></span>
<span><span class="co">#&gt;   Native Hawaiian/Other Pacific Islander </span></span>
<span><span class="co">#&gt; "Native Hawaiian/Other Pacific Islander" </span></span>
<span><span class="co">#&gt;                                    NH/PI </span></span>
<span><span class="co">#&gt; "Native Hawaiian/Other Pacific Islander" </span></span>
<span><span class="co">#&gt;         Native Hawaiian/Pacific Islander </span></span>
<span><span class="co">#&gt; "Native Hawaiian/Other Pacific Islander" </span></span>
<span><span class="co">#&gt;                                       R4 </span></span>
<span><span class="co">#&gt; "Native Hawaiian/Other Pacific Islander" </span></span>
<span><span class="co">#&gt;                                    White </span></span>
<span><span class="co">#&gt;                                  "White" </span></span>
<span><span class="co">#&gt;                                       R5 </span></span>
<span><span class="co">#&gt;                                  "White" </span></span>
<span><span class="co">#&gt;                                  Unknown </span></span>
<span><span class="co">#&gt;                                "Unknown" </span></span>
<span><span class="co">#&gt;                                      UNK </span></span>
<span><span class="co">#&gt;                                "Unknown" </span></span>
<span><span class="co">#&gt;                                    Other </span></span>
<span><span class="co">#&gt;                                  "Other" </span></span>
<span><span class="co">#&gt;                       More Than One Race </span></span>
<span><span class="co">#&gt;                            "Multiracial" </span></span>
<span><span class="co">#&gt;                               Multi-race </span></span>
<span><span class="co">#&gt;                            "Multiracial"</span></span>
<span><span class="va">racemap</span><span class="op">[</span><span class="st">"AI/AN"</span><span class="op">]</span></span>
<span><span class="co">#&gt;                           AI/AN </span></span>
<span><span class="co">#&gt; "American Indian/Alaska Native"</span></span>
<span><span class="va">racemap</span><span class="op">[</span><span class="st">"Black"</span><span class="op">]</span></span>
<span><span class="co">#&gt;                    Black </span></span>
<span><span class="co">#&gt; "Black/African American"</span></span>
<span><span class="va">racemap</span><span class="op">[</span><span class="st">"Doesn't exist in the mapping"</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;NA&gt; </span></span>
<span><span class="co">#&gt;   NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">racemap</span><span class="op">)</span></span>
<span><span class="co">#&gt; racemap</span></span>
<span><span class="co">#&gt;          American Indian/Alaska Native                                  Asian </span></span>
<span><span class="co">#&gt;                                      4                                      2 </span></span>
<span><span class="co">#&gt;                 Black/African American                            Multiracial </span></span>
<span><span class="co">#&gt;                                      4                                      2 </span></span>
<span><span class="co">#&gt; Native Hawaiian/Other Pacific Islander                                  Other </span></span>
<span><span class="co">#&gt;                                      4                                      1 </span></span>
<span><span class="co">#&gt;                                Unknown                                  White </span></span>
<span><span class="co">#&gt;                                      2                                      2</span></span></code></pre></div>
<p>Now we can write a function that harmonizes a race variable in a data
frame in <code>R/utils.R</code>. Notice how we reference the
<code>racemap</code> object from the package namespace with
<code><a href="../reference/racemap.html">rpkgdemo::racemap</a></code>, and we‚Äôre simply using that named vector
to do the harmonization. We pass the data frame to the function along
with the name of the original race columnn in the data frame. The
function adds a new column called <code>.race_standardized</code>.
Prefixing variables added by functions with a dot is a common convention
to avoid overwriting an existing variable that might be called
<code>race_standardized</code>.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Standardize race variable</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x A data frame containing a race column to harmonize</span></span>
<span><span class="co">#' @param racecol The name of the race column. Default is "race".</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @returns A new data frame with an additional `.race_standardized` column</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @seealso [racemap]</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#' set.seed(123)</span></span>
<span><span class="co">#' mydata &lt;- data.frame(reported_race=sample(names(racemap), 20, replace=TRUE))</span></span>
<span><span class="co">#' mydata$reported_race[15] &lt;- "Martian"</span></span>
<span><span class="co">#' mydata</span></span>
<span><span class="co">#' standardize_race(mydata, racecol="reported_race")</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">standardize_race</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">racecol</span> <span class="op">=</span> <span class="st">"race"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">racecol</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Column"</span>, <span class="va">racecol</span>, <span class="st">"not found in data"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span><span class="op">$</span><span class="va">.race_standardized</span> <span class="op">&lt;-</span> <span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/racemap.html">racemap</a></span><span class="op">[</span><span class="va">x</span><span class="op">[[</span><span class="va">racecol</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Document, rebuild, check, then try it out.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate some fake data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>reported_race<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">racemap</span><span class="op">)</span>, <span class="fl">20</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mydata</span><span class="op">$</span><span class="va">reported_race</span><span class="op">[</span><span class="fl">15</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Martian"</span></span>
<span><span class="va">mydata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 √ó 1</span></span></span>
<span><span class="co">#&gt;    reported_race                         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> White                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> R4                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Native American/Alaskan Native        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> R3                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> UNK                                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Native Hawaiian/Other Pacific Islander</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asian                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> More Than One Race                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> R4                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Asian                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Black or African American             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Native American/Alaskan Native        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Martian                               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> R3                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Black or African American             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> R1</span></span>
<span></span>
<span><span class="co"># Now standardize that race data</span></span>
<span><span class="va">mydata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span>racecol<span class="op">=</span><span class="st">"reported_race"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 √ó 2</span></span></span>
<span><span class="co">#&gt;    reported_race                          .race_standardized                    </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> White                                  White                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Other                                  Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> R4                                     Native Hawaiian/Other Pacific Islander</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Native American/Alaskan Native         American Indian/Alaska Native         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> R3                                     Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> UNK                                    Unknown                               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Native Hawaiian/Other Pacific Islander Native Hawaiian/Other Pacific Islander</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asian                                  Asian                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> More Than One Race                     Multiracial                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> R4                                     Native Hawaiian/Other Pacific Islander</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Asian                                  Asian                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Other                                  Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Black or African American              Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Native American/Alaskan Native         American Indian/Alaska Native         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Martian                                <span style="color: #BB0000;">NA</span>                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Black/African American                 Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> R3                                     Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Black or African American              Black/African American                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Other                                  Other                                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> R1                                     American Indian/Alaska Native</span></span></code></pre></div>
<p>Finally, we can write some tests for this function. These tests were
written wholly by Positron Assitant using Claude Sonnet 4.5.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"standardize_race"</span>, <span class="op">{</span></span>
<span>  <span class="co"># standardize_race adds .race_standardized column</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Asian"</span><span class="op">)</span>,</span>
<span>    other_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="st">".race_standardized"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># standardize_race works with custom column name</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    reported_race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Asian"</span><span class="op">)</span>,</span>
<span>    other_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span>, racecol <span class="op">=</span> <span class="st">"reported_race"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="st">".race_standardized"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># standardize_race uses racemap correctly</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/racemap.html">racemap</a></span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span></span>
<span>    <span class="va">result</span><span class="op">$</span><span class="va">.race_standardized</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/racemap.html">racemap</a></span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">rpkgdemo</span><span class="fu">::</span><span class="va"><a href="../reference/racemap.html">racemap</a></span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># standardize_race handles unmapped values with NA</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>, <span class="st">"Martian"</span>, <span class="st">"Klingon"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">.race_standardized</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">expect_true</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">.race_standardized</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># standardize_race throws error when column not found</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    other_col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">expect_error</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span>,</span>
<span>    <span class="st">"Column race not found in data"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># standardize_race throws error with custom column not found</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>, <span class="st">"Black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">expect_error</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span>, racecol <span class="op">=</span> <span class="st">"nonexistent"</span><span class="op">)</span>,</span>
<span>    <span class="st">"Column nonexistent not found in data"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># standardize_race preserves original columns</span></span>
<span>  <span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"White"</span>, <span class="st">"Black"</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_race.html">standardize_race</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">race</span>, <span class="va">test_data</span><span class="op">$</span><span class="va">race</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">id</span>, <span class="va">test_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">value</span>, <span class="va">test_data</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Let‚Äôs test and check:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚Ñπ Testing rpkgdemo
‚úî | F W  S  OK | Context
‚úî |         36 | utils
‚ïê‚ïê Results ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
[ FAIL 0 | WARN 0 | SKIP 0 | PASS 36 ]

üåà Your tests are over the rainbow üåà</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">covr</span><span class="fu">::</span><span class="fu">package_coverage</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>rpkgdemo Coverage: 100.00%
R/utils.R: 100.00%</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚îÄ‚îÄ R CMD check results ‚îÄ‚îÄ rpkgdemo 0.0.0.9000 ‚îÄ‚îÄ
Duration: 11.9s

0 errors ‚úî | 0 warnings ‚úî | 0 notes ‚úî</code></pre>
</div>
<div class="section level2">
<h2 id="readme-rmd">README.Rmd<a class="anchor" aria-label="anchor" href="#readme-rmd"></a>
</h2>
<p>The README file is the first thing people see when they visit your
package repository on GitHub. It‚Äôs a great place to provide an overview
of your package, how to install it, and some basic usage examples. You
can create a README file using R Markdown, which allows you to include
formatted text, code chunks, and output. You‚Äôll name the file
<code>README.Rmd</code>, then you can use
<code>devtools::build_readme()</code> to render it to
<code>README.md</code>, which is what GitHub displays. To create a
README.Rmd file, you can use the <code>usethis::use_readme_rmd()</code>
function.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_readme_rmd</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Then use <code>devtools::build_readme()</code> to render it. Besides
just running knitr to render the file, it installs a temporary copy of
the package then renders the README.Rmd in a clean session.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_readme</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="github-actions">GitHub Actions<a class="anchor" aria-label="anchor" href="#github-actions"></a>
</h2>
<p>GitHub Actions (GHA) allow you to automate workflows for your
package, such as running tests and package checks, or building
documentation. The <code>usethis</code> package provides functions to
set up common GHA workflows for R packages. This will create the
necessary YAML files in the <code>.github/workflows/</code> directory of
your package to run a package check whenever (1) you push or merge to
the main branch, or (2) you open up a pull request to the main branch
from any development branch.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_github_action</span><span class="op">(</span><span class="st">"check-release"</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚úî Setting active project to "/Users/sdt5z/repos/rpkgdemo".
‚úî Creating .github/.
‚úî Adding "^\\.github$" to .Rbuildignore.
‚úî Adding "*.html" to .github/.gitignore.
‚úî Creating .github/workflows/.
‚úî Saving "r-lib/actions/examples/check-release.yaml@v2" to .github/workflows/R-CMD-check.yaml.
‚òê Learn more at &lt;https://github.com/r-lib/actions/blob/v2/examples/README.md&gt;.
‚úî Adding "R-CMD-check badge" to README.Rmd.
‚òê Re-knit README.Rmd with devtools::build_readme().
&gt; devtools::build_readme()
‚Ñπ Installing rpkgdemo in temporary library
‚Ñπ Building /Users/sdt5z/repos/rpkgdemo/README.Rmd</code></pre>
<p><img src="img/gha-check.png" class="r-plt" alt="GitHub Action for R CMD check"></p>
<p>Taking this a step furtner, you can go into the settings for your
GitHub repository, click into the Rules section, and create a new branch
protection rule to require (1) pull requests to main, blocking direct
pushes to main, and (2) that the R CMD check action passes before
allowing a pull request to be merged into main.</p>
<p>If we were to do something that causes the check to fail, we can‚Äôt
merge into main!</p>
<p><img src="img/gha-checkfail.png" class="r-plt" alt="Merging is blocked until the status checks pass"></p>
<p>We can go into the details to see what happened:</p>
<p><img src="img/gha-checkdetails.png" class="r-plt" alt="Details on the package check GitHub action"></p>
<p>Once we fix the issue we can merge to main:</p>
<p><img src="img/gha-checkpass.png" class="r-plt" alt="Merging is allowed once the check succeeds"></p>
</div>
<div class="section level2">
<h2 id="pkgdown">pkgdown<a class="anchor" aria-label="anchor" href="#pkgdown"></a>
</h2>
<p>The <code>pkgdown</code> package makes it easy to create a website
for your R package. The website can include function reference,
vignettes, articles, and more. You can set up <code>pkgdown</code> for
your package using the <code>usethis::use_pkgdown()</code> function.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_pkgdown</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Before you render your site, make sure your README is up to date.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_readme</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, you can build the site with <code><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a></code>.
This builds a complete website by rendering the home page from the
README, function reference from the docs, articles from your vignettes,
NEWS files, LLM docs, and more.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>See the pkgdown website for this package:</p>
<ul>
<li>Homepage: <a href="https://stephenturner.github.io/rpkgdemo/" class="uri">https://stephenturner.github.io/rpkgdemo/</a>
</li>
<li>Vignette (full tutorial): <a href="https://stephenturner.github.io/rpkgdemo/articles/rpkgdemo.html" class="uri">https://stephenturner.github.io/rpkgdemo/articles/rpkgdemo.html</a>
</li>
<li>Function reference: <a href="https://stephenturner.github.io/rpkgdemo/reference/index.html" class="uri">https://stephenturner.github.io/rpkgdemo/reference/index.html</a>
</li>
</ul>
<p>The pkgdown package also creates an LLMs.txt at the root of your site
that contains the contents of your README.md, your reference index, and
your articles index. It also creates a .md file for every existing .html
file in your site. Together, this gives an LLM an overview of your
package and the ability to find out more by following links. For
example:</p>
<ul>
<li><a href="https://stephenturner.github.io/rpkgdemo/llms.txt" class="uri">https://stephenturner.github.io/rpkgdemo/llms.txt</a></li>
<li><a href="https://stephenturner.github.io/rpkgdemo/articles/rpkgdemo.md" class="uri">https://stephenturner.github.io/rpkgdemo/articles/rpkgdemo.md</a></li>
<li><a href="https://stephenturner.github.io/rpkgdemo/reference/index.md" class="uri">https://stephenturner.github.io/rpkgdemo/reference/index.md</a></li>
<li><a href="https://stephenturner.github.io/rpkgdemo/reference/prep_lab_data.md" class="uri">https://stephenturner.github.io/rpkgdemo/reference/prep_lab_data.md</a></li>
</ul>
<p>Finally, you can automate the deployment of your pkgdown website with
yet another GitHub Action: And the vignette here:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_pkgdown_github_pages</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>‚úî Writing _pkgdown.yml.
‚òê Modify _pkgdown.yml.
‚úî Initializing empty, orphan branch "gh-pages" in GitHub repo "stephenturner/rpkgdemo".
‚úî GitHub Pages is publishing from:
‚Ä¢ URL: "https://stephenturner.github.io/rpkgdemo/"
‚Ä¢ Branch: "gh-pages"
‚Ä¢ Path: "/"
‚úî Saving "r-lib/actions/examples/pkgdown.yaml@v2" to .github/workflows/pkgdown.yaml.
‚òê Learn more at &lt;https://github.com/r-lib/actions/blob/v2/examples/README.md&gt;.
‚úî Recording &lt;https://stephenturner.github.io/rpkgdemo/&gt; as site's url in _pkgdown.yml.
‚òê Run devtools::document() to update package-level documentation.
‚úî Setting &lt;https://stephenturner.github.io/rpkgdemo/&gt; as homepage of GitHub repo "stephenturner/rpkgdemo".</code></pre>
<p>Now whenever you push new changes to main, the pkgdown site will be
rebuilt and redeployed automatically.</p>
</div>
<div class="section level2">
<h2 id="other-topics">Other topics<a class="anchor" aria-label="anchor" href="#other-topics"></a>
</h2>
<div class="section level3">
<h3 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a>
</h3>
<p>You can create a vignette with <code>usethis::use_vignette()</code>.
This creates a <code>vignettes/</code> directory and a template R
Markdown file for your vignette. If you name the vignette the same name
as your package (‚Äúrpkgdemo‚Äù here), it will be the main vignette that
shows up first in your pkgdown site. Others show up under the ‚Äúarticles‚Äù
section. See <a href="https://dplyr.tidyverse.org/" class="external-link uri">https://dplyr.tidyverse.org/</a> for an example.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_vignette</span><span class="op">(</span><span class="st">"rpkgdemo"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="news">NEWS<a class="anchor" aria-label="anchor" href="#news"></a>
</h3>
<p>You can create a basic <code>NEWS.md</code> file with
<code>usethis::use_news_md()</code>. This also adds a link and new
Changelog page in your pkgdown site.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_news_md</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hex-stickers">Hex stickers<a class="anchor" aria-label="anchor" href="#hex-stickers"></a>
</h3>
<p>All packages need a good logo, right? You can make your own here: <a href="https://connect.thinkr.fr/hexmake/" class="external-link uri">https://connect.thinkr.fr/hexmake/</a>. Once you do that you
can add the logo to <code>./man/figures/logo.png</code> then add this
bit of markdown/HTML the README.Rmd, which will show up in the package
README and pkgdown docs:</p>
<pre><code><span><span class="co"># rpkgdemo &lt;a href='https://github.com/stephenturner/rpkgdemo'&gt;&lt;img src='man/figures/logo.png' align="right" height="200" /&gt;&lt;/a&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="r-universe">R Universe<a class="anchor" aria-label="anchor" href="#r-universe"></a>
</h3>
<p>You can create a CRAN-like repository at <a href="https://r-universe.dev/" class="external-link uri">https://r-universe.dev/</a>
by following a few short steps <a href="https://docs.r-universe.dev/publish/set-up.html" class="external-link">described
here</a>. Doing this result in the package being built for Windows, Mac,
Linux, and WebR, and provides easy installation instructions for users.
See the R Universe assets for this package:</p>
<ul>
<li>My personal universe: <a href="https://stephenturner.r-universe.dev/" class="external-link uri">https://stephenturner.r-universe.dev/</a>
</li>
<li>The rpkgdemo package page: <a href="https://stephenturner.r-universe.dev/rpkgdemo" class="external-link uri">https://stephenturner.r-universe.dev/rpkgdemo</a>
</li>
<li>Automatically built PDF manual: <a href="https://stephenturner.r-universe.dev/rpkgdemo/rpkgdemo.pdf" class="external-link uri">https://stephenturner.r-universe.dev/rpkgdemo/rpkgdemo.pdf</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="cran-submission">CRAN submission<a class="anchor" aria-label="anchor" href="#cran-submission"></a>
</h3>
<p>You might want to submit your package to CRAN. The devools package
can help with this. It‚Äôll take you through a series of questions and
then submit your source package to CRAN. You might want to check out <a href="https://github.com/DavisVaughan/extrachecks" class="external-link">DavisVaughan/extrachecks</a>
for information about additional ad-hoc checks that the CRAN maintainers
run that aren‚Äôt checked by <code>devtools::check()</code>.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">release</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="docker-pracpac">Docker &amp; pracpac<a class="anchor" aria-label="anchor" href="#docker-pracpac"></a>
</h3>
<p>The <code>pracpac</code> package makes it easy to create Docker
images for your R packages. You can read more about it in the <a href="https://arxiv.org/abs/2303.07876" class="external-link">paper</a> and try it out via <a href="https://cran.r-project.org/package=pracpac" class="external-link">CRAN</a> or <a href="https://github.com/signaturescience/pracpac" class="external-link">GitHub</a>.</p>
</div>
<div class="section level3">
<h3 id="additional-resources">Additional resources<a class="anchor" aria-label="anchor" href="#additional-resources"></a>
</h3>
<p>Instead of a long list of resources that‚Äôll be out of date in a year
or two, I‚Äôll leave you with one resource: The <strong><em>R
Packages</em></strong> book by Hadley Wickham and Jenny Bryan. It‚Äôs
available online for free at <strong><a href="https://r-pkgs.org/" class="external-link uri">https://r-pkgs.org/</a></strong>. It‚Äôs the definitive
resource for building R packages.</p>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session Information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 24.04.3 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.26.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">#&gt;  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">#&gt; [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: UTC</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] dplyr_1.1.4    rpkgdemo_1.0.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] vctrs_0.6.5       cli_3.6.5         knitr_1.50        rlang_1.1.6      </span></span>
<span><span class="co">#&gt;  [5] xfun_0.55         generics_0.1.4    textshaping_1.0.4 jsonlite_2.0.0   </span></span>
<span><span class="co">#&gt;  [9] glue_1.8.0        htmltools_0.5.9   ragg_1.5.0        sass_0.4.10      </span></span>
<span><span class="co">#&gt; [13] rmarkdown_2.30    tibble_3.3.0      evaluate_1.0.5    jquerylib_0.1.4  </span></span>
<span><span class="co">#&gt; [17] fastmap_1.2.0     yaml_2.3.12       lifecycle_1.0.4   compiler_4.5.2   </span></span>
<span><span class="co">#&gt; [21] fs_1.6.6          pkgconfig_2.0.3   systemfonts_1.3.1 digest_0.6.39    </span></span>
<span><span class="co">#&gt; [25] R6_2.6.1          utf8_1.2.6        tidyselect_1.2.1  pillar_1.11.1    </span></span>
<span><span class="co">#&gt; [29] magrittr_2.0.4    bslib_0.9.0       tools_4.5.2       pkgdown_2.2.0    </span></span>
<span><span class="co">#&gt; [33] cachem_1.1.0      desc_1.4.3</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stephen Turner.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
